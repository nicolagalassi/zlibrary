<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZuLibrary - Archivio</title>
    <link rel="stylesheet" href="css/style.css">
    <script defer src="https://cloud.umami.is/script.js" data-website-id="ecfe38f9-d4f7-4dc3-9138-6901aa3e4ed9"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 font-sans">

      <header class="bg-white dark:bg-gray-800 shadow p-4">
    <div class="max-w-4xl mx-auto flex justify-between items-center">
      <h1 class="flex items-center gap-2 text-2xl font-bold text-gray-700 dark:text-gray-200">
        <!-- Logo -->
        <svg width="28" height="28" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" fill="none">
          <rect width="120" height="120" rx="20" fill="#2563eb"/>
          <path d="M35 35H85V85H35V35Z" stroke="white" stroke-width="8"/>
          <path d="M45 45H75V55H55L75 75H45V65H65L45 45Z" fill="white"/>
        </svg>
        ZuLibrary
      </h1>
      
      <!-- ... resto dell'header rimane invariato ... -->
    </div>
  </header>

    <main class="max-w-6xl mx-auto p-4">
        <h2 class="text-2xl font-semibold mb-4">Archivio dei Sommari</h2>
        <div id="archivio-container" class="max-w-2xl mx-auto">
            </div>
    </main>

    <script>
fetch('js/archivio_circolari.json')
  .then(response => response.json())
  .then(data => {
   const archivioContainer = document.getElementById('archivio-container');
   
   // Raggruppa prima per applicativo (HR1)
   const circolariPerApp = {};
   data.forEach(circolare => {
    const app = circolare.url.split('/')[4]; // Estrae HR1 dall'URL
    if (!circolariPerApp[app]) {
     circolariPerApp[app] = {};
    }
    
    // Poi raggruppa per anno all'interno di ogni applicativo
    const majorGroup = circolare.versione.substring(0, 2);
    if (!circolariPerApp[app][majorGroup]) {
     circolariPerApp[app][majorGroup] = [];
    }
    circolariPerApp[app][majorGroup].push(circolare);
   });

   // Per ogni applicativo
   Object.keys(circolariPerApp).forEach(app => {
    // Crea il container dell'applicativo
    const appDiv = document.createElement('div');
    appDiv.classList.add('app-group', 'mb-6', 'bg-white', 'dark:bg-gray-800', 'rounded-lg', 'shadow-lg', 'overflow-hidden');
    
    // Crea l'header dell'applicativo
    const appHeader = document.createElement('div');
    appHeader.classList.add('app-header', 'flex', 'items-center', 'gap-2', 'p-3', 'cursor-pointer', 'hover:bg-blue-50', 'dark:hover:bg-gray-700', 'transition-colors');
    
    // Icona cartella
    const folderIcon = document.createElement('div');
    folderIcon.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
    </svg>`;
    
    // Nome applicativo
    const appName = document.createElement('span');
    appName.classList.add('text-gray-800', 'dark:text-gray-200', 'font-medium');
    appName.textContent = app;
    
    // Icona freccia
    const arrowIcon = document.createElement('div');
    arrowIcon.classList.add('ml-2');
    arrowIcon.innerHTML = `
    <svg class="w-4 h-4 text-gray-500 dark:text-gray-400 transform transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
    </svg>`;
    
    appHeader.appendChild(folderIcon);
    appHeader.appendChild(appName);
    appHeader.appendChild(arrowIcon);
    appDiv.appendChild(appHeader);
    
    // Crea il contenitore per gli anni
    const yearsContainer = document.createElement('div');
    yearsContainer.classList.add('years-container');
    yearsContainer.style.display = 'none'; // Nascosto inizialmente
    
    // Ordina gli anni in ordine decrescente
    const years = Object.keys(circolariPerApp[app]).sort((a, b) => parseInt(b) - parseInt(a));
    
    years.forEach(year => {
     const yearDiv = document.createElement('div');
     yearDiv.classList.add('year-group', 'border-t', 'border-gray-100', 'dark:border-gray-700');
     
     const yearHeader = document.createElement('div');
     yearHeader.classList.add('year-header', 'flex', 'items-center', 'gap-2', 'p-2', 'pl-8', 'cursor-pointer', 'hover:bg-gray-50', 'dark:hover:bg-gray-700', 'transition-colors');
     
     // Icona cartella anno
     const yearFolderIcon = document.createElement('div');
     yearFolderIcon.innerHTML = `
     <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-500 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
     </svg>`;
     
     // Anno
     const yearText = document.createElement('span');
     yearText.classList.add('text-gray-700', 'dark:text-gray-300');
     yearText.textContent = `20${year}`;
     
     // Icona freccia anno
     const yearArrowIcon = document.createElement('div');
     yearArrowIcon.classList.add('ml-1');
     yearArrowIcon.innerHTML = `
     <svg class="w-3 h-3 text-gray-400 dark:text-gray-500 transform transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
     </svg>`;
     
     yearHeader.appendChild(yearFolderIcon);
     yearHeader.appendChild(yearText);
     yearHeader.appendChild(yearArrowIcon);
     yearDiv.appendChild(yearHeader);
     
     const circolariDiv = document.createElement('div');
     circolariDiv.classList.add('circolari-container', 'pl-12', 'pr-4');
     circolariDiv.style.display = 'none';
     
     // Crea la tabella per le versioni
     const table = document.createElement('table');
     table.classList.add('min-w-full', 'my-2');
     
     const tbody = document.createElement('tbody');
     circolariPerApp[app][year].forEach(circolare => {
      const patch = circolare.versione.split('_')[1];
      const badge = patch === '000'
       ? `<span class="ml-2 inline-block bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 text-xs px-2 py-0.5 rounded">Master</span>`
       : `<span class="ml-2 inline-block bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 text-xs px-2 py-0.5 rounded">UPD</span>`;
      
      const row = document.createElement('tr');
      row.classList.add('hover:bg-gray-50', 'dark:hover:bg-gray-700');
      row.innerHTML = `
       <td class="py-1.5 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
        <span class="font-mono text-sm">${circolare.versione}${badge}</span>
        <a href="${circolare.url}" class="ml-auto text-blue-600 dark:text-blue-400 hover:underline text-sm" target="_blank">Scarica PDF</a>
       </td>
      `;
      tbody.appendChild(row);
     });
     
     table.appendChild(tbody);
     circolariDiv.appendChild(table);
     yearDiv.appendChild(circolariDiv);
     
     // Event listener per l'anno
     yearHeader.addEventListener('click', () => {
      const isOpen = circolariDiv.style.display !== 'none';
      circolariDiv.style.display = isOpen ? 'none' : 'block';
      yearHeader.querySelector('svg:last-child').style.transform = isOpen ? 'rotate(0deg)' : 'rotate(90deg)';
     });
     
     yearsContainer.appendChild(yearDiv);
    });
    
    appDiv.appendChild(yearsContainer);
    
    // Event listener per l'applicativo
    appHeader.addEventListener('click', () => {
     const isOpen = yearsContainer.style.display !== 'none';
     yearsContainer.style.display = isOpen ? 'none' : 'block';
     appHeader.querySelector('svg:last-child').style.transform = isOpen ? 'rotate(0deg)' : 'rotate(90deg)';
    });
    
    archivioContainer.appendChild(appDiv);
   });
  })
  .catch(error => {
   console.error('Errore nel caricamento dell\'archivio:', error);
  });

        const toggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') html.classList.add('dark');
        toggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
        });
    </script>

</body>
</html>
